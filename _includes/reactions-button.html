<!-- Sistema de Reacciones - "Qui茅reme" -->
<div class="reactions-section">
  <h4 class="reactions-title">驴Te gust贸 este art铆culo?</h4>
  
  <div class="reactions-container">
    <button class="reaction-btn" data-reaction="love" title="Me encanta">
      <span class="reaction-emoji">わ</span>
      <span class="reaction-count">0</span>
    </button>
    
    <button class="reaction-btn" data-reaction="fire" title="Est谩 ardiendo">
      <span class="reaction-emoji"></span>
      <span class="reaction-count">0</span>
    </button>
    
    <button class="reaction-btn" data-reaction="clap" title="Aplausos">
      <span class="reaction-emoji"></span>
      <span class="reaction-count">0</span>
    </button>
    
    <button class="reaction-btn" data-reaction="think" title="Interesante">
      <span class="reaction-emoji"></span>
      <span class="reaction-count">0</span>
    </button>
    
    <button class="reaction-btn" data-reaction="rocket" title="Incre铆ble">
      <span class="reaction-emoji"></span>
      <span class="reaction-count">0</span>
    </button>
  </div>
  
  <p class="reactions-message" id="reactionsMessage"></p>
</div>

<style>
.reactions-section {
  margin: 3rem 0;
  padding: 2rem;
  background: linear-gradient(135deg, var(--color-bg) 0%, var(--color-bg-secondary) 100%);
  border: 1px solid var(--color-border);
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 2px 8px var(--color-shadow);
}

.reactions-title {
  font-family: var(--font-display);
  font-size: 1.2rem;
  color: var(--color-text);
  margin: 0 0 1.5rem;
  font-weight: 600;
}

.reactions-container {
  display: flex;
  justify-content: center;
  gap: 1rem;
  flex-wrap: wrap;
  margin-bottom: 1rem;
}

.reaction-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  padding: 1rem;
  min-width: 70px;
  background: var(--color-bg);
  border: 2px solid var(--color-border);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.reaction-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--color-orange);
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 0;
}

.reaction-btn:hover {
  transform: translateY(-5px) scale(1.1);
  box-shadow: 0 6px 20px rgba(243, 79, 41, 0.3);
  border-color: var(--color-orange);
}

.reaction-btn:hover::before {
  opacity: 0.1;
}

.reaction-btn.active {
  background: var(--color-orange);
  border-color: var(--color-orange);
  color: white;
  transform: scale(1.15);
}

.reaction-btn.active .reaction-emoji {
  animation: bounce 0.5s ease;
}

.reaction-emoji {
  font-size: 2rem;
  line-height: 1;
  position: relative;
  z-index: 1;
  transition: transform 0.3s ease;
}

.reaction-btn:hover .reaction-emoji {
  transform: scale(1.3);
}

.reaction-count {
  font-family: var(--font-sans);
  font-size: 0.9rem;
  font-weight: 700;
  color: var(--color-text);
  position: relative;
  z-index: 1;
  min-width: 20px;
  transition: color 0.3s ease;
}

.reaction-btn.active .reaction-count {
  color: white;
}

.reactions-message {
  margin-top: 1.5rem;
  font-family: var(--font-sans);
  font-size: 0.9rem;
  color: var(--color-text-muted);
  font-style: italic;
  min-height: 1.5rem;
  animation: fadeIn 0.3s ease;
}

@keyframes bounce {
  0%, 100% { transform: scale(1); }
  25% { transform: scale(1.4); }
  50% { transform: scale(1.1); }
  75% { transform: scale(1.3); }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-5px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.reaction-btn.loading {
  pointer-events: none;
  animation: pulse 1s infinite;
}

@media (max-width: 600px) {
  .reactions-section {
    padding: 1.5rem 1rem;
  }
  
  .reactions-title {
    font-size: 1.1rem;
  }
  
  .reactions-container {
    gap: 0.75rem;
  }
  
  .reaction-btn {
    min-width: 60px;
    padding: 0.85rem;
  }
  
  .reaction-emoji {
    font-size: 1.75rem;
  }
  
  .reaction-count {
    font-size: 0.85rem;
  }
}
</style>

<script>
(function() {
  'use strict';
  
  // Configuraci贸n
  var POST_ID = '{{ page.url | slugify }}';
  var STORAGE_KEY_PREFIX = 'reactions_';
  var USER_REACTIONS_KEY = 'user_reactions_' + POST_ID;
  
  // Elementos
  var reactionButtons = document.querySelectorAll('.reaction-btn');
  var messageElement = document.getElementById('reactionsMessage');
  
  // Mensajes de respuesta
  var reactionMessages = {
    love: '隆Gracias por el amor! わ',
    fire: '隆Est谩 ardiendo! ',
    clap: '隆Gracias por los aplausos! ',
    think: '隆Me alegra que te haga pensar! ',
    rocket: '隆Al infinito y m谩s all谩! '
  };
  
  // Obtener reacciones del post
  function getReactions() {
    try {
      var allReactions = JSON.parse(localStorage.getItem(STORAGE_KEY_PREFIX + POST_ID) || '{}');
      return {
        love: allReactions.love || 0,
        fire: allReactions.fire || 0,
        clap: allReactions.clap || 0,
        think: allReactions.think || 0,
        rocket: allReactions.rocket || 0
      };
    } catch (e) {
      return { love: 0, fire: 0, clap: 0, think: 0, rocket: 0 };
    }
  }
  
  // Guardar reacciones
  function saveReactions(reactions) {
    try {
      localStorage.setItem(STORAGE_KEY_PREFIX + POST_ID, JSON.stringify(reactions));
    } catch (e) {
      console.error('No se pudieron guardar las reacciones:', e);
    }
  }
  
  // Obtener reacciones del usuario
  function getUserReactions() {
    try {
      return JSON.parse(localStorage.getItem(USER_REACTIONS_KEY) || '[]');
    } catch (e) {
      return [];
    }
  }
  
  // Guardar reacci贸n del usuario
  function saveUserReaction(reaction) {
    try {
      var userReactions = getUserReactions();
      if (userReactions.indexOf(reaction) === -1) {
        userReactions.push(reaction);
        localStorage.setItem(USER_REACTIONS_KEY, JSON.stringify(userReactions));
      }
    } catch (e) {
      console.error('No se pudo guardar la reacci贸n del usuario:', e);
    }
  }
  
  // Remover reacci贸n del usuario
  function removeUserReaction(reaction) {
    try {
      var userReactions = getUserReactions();
      var index = userReactions.indexOf(reaction);
      if (index !== -1) {
        userReactions.splice(index, 1);
        localStorage.setItem(USER_REACTIONS_KEY, JSON.stringify(userReactions));
      }
    } catch (e) {
      console.error('No se pudo remover la reacci贸n del usuario:', e);
    }
  }
  
  // Actualizar UI
  function updateUI() {
    var reactions = getReactions();
    var userReactions = getUserReactions();
    
    reactionButtons.forEach(function(btn) {
      var reaction = btn.getAttribute('data-reaction');
      var countEl = btn.querySelector('.reaction-count');
      
      countEl.textContent = reactions[reaction] || 0;
      
      if (userReactions.indexOf(reaction) !== -1) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });
  }
  
  // Mostrar mensaje temporal
  function showMessage(message) {
    if (messageElement) {
      messageElement.textContent = message;
      messageElement.style.animation = 'none';
      setTimeout(function() {
        messageElement.style.animation = 'fadeIn 0.3s ease';
      }, 10);
      
      setTimeout(function() {
        messageElement.textContent = '';
      }, 3000);
    }
  }
  
  // Manejar click en reacci贸n
  function handleReaction(event) {
    var btn = event.currentTarget;
    if (btn.classList.contains('loading')) return;
    
    var reaction = btn.getAttribute('data-reaction');
    var reactions = getReactions();
    var userReactions = getUserReactions();
    var isActive = userReactions.indexOf(reaction) !== -1;
    
    btn.classList.add('loading');
    
    setTimeout(function() {
      if (isActive) {
        // Remover reacci贸n
        reactions[reaction] = Math.max(0, reactions[reaction] - 1);
        removeUserReaction(reaction);
        showMessage('Reacci贸n removida');
      } else {
        // Agregar reacci贸n
        reactions[reaction]++;
        saveUserReaction(reaction);
        showMessage(reactionMessages[reaction]);
      }
      
      saveReactions(reactions);
      updateUI();
      btn.classList.remove('loading');
    }, 300);
  }
  
  // Inicializar
  function init() {
    if (reactionButtons.length === 0) return;
    
    updateUI();
    
    reactionButtons.forEach(function(btn) {
      btn.addEventListener('click', handleReaction);
    });
  }
  
  // Ejecutar cuando el DOM est茅 listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>