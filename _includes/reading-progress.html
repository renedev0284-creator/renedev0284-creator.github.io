<div id="reading-progress-bar"></div>

<style>
#reading-progress-bar {
  position: fixed;
  top: 0;
  left: 0;
  width: 0%;
  height: 4px;
  background: linear-gradient(90deg, var(--color-orange) 0%, #e04420 100%);
  z-index: 9999;
  transition: width 0.1s ease-out;
  box-shadow: 0 2px 4px rgba(243, 79, 41, 0.3);
}

#reading-progress-bar.complete {
  animation: progressComplete 0.6s ease;
}

@keyframes progressComplete {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

@media (max-width: 768px) {
  #reading-progress-bar {
    height: 3px;
  }
}
</style>

<script>
(function() {
  'use strict';
  
  const progressBar = document.getElementById('reading-progress-bar');
  if (!progressBar) return;
  
  // Esperar a que el DOM esté completamente cargado
  function initProgressBar() {
    // Buscar el contenido del post específicamente
    const postContent = document.querySelector('.post-content');
    
    if (!postContent) {
      console.warn('No se encontró .post-content, usando documento completo');
      return;
    }
    
    function updateProgressBar() {
      // Obtener posición del contenido del post
      const postTop = postContent.offsetTop;
      const postHeight = postContent.offsetHeight;
      const postBottom = postTop + postHeight;
      
      // Scroll actual
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const windowHeight = window.innerHeight;
      
      // Calcular progreso solo dentro del post-content
      let progress = 0;
      
      if (scrollTop + windowHeight >= postTop && scrollTop <= postBottom) {
        // Estamos en el rango del post
        const scrolledInPost = Math.max(0, scrollTop + windowHeight - postTop);
        const totalScrollable = postHeight + windowHeight;
        progress = (scrolledInPost / totalScrollable) * 100;
      } else if (scrollTop > postBottom) {
        // Ya pasamos el post
        progress = 100;
      }
      
      // Limitar entre 0 y 100
      progress = Math.min(Math.max(progress, 0), 100);
      
      // Actualizar barra
      progressBar.style.width = progress + '%';
      
      // Añadir clase cuando se complete
      if (progress >= 99) {
        progressBar.classList.add('complete');
      } else {
        progressBar.classList.remove('complete');
      }
    }
    
    // Eventos
    window.addEventListener('scroll', updateProgressBar, { passive: true });
    window.addEventListener('resize', updateProgressBar, { passive: true });
    
    // Primera actualización
    updateProgressBar();
  }
  
  // Ejecutar cuando el DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initProgressBar);
  } else {
    initProgressBar();
  }
})();
</script>