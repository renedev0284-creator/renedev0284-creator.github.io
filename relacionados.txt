<!-- Script para insertar enlace relacionado INLINE despu√©s del p√°rrafo 2 -->
<script>
(function() {
  'use strict';
  
  console.log('üîç Iniciando inserci√≥n de enlace relacionado...');
  
  // Datos del post actual y posts relacionados
  var currentTags = {{ page.tags | jsonify }};
  var allPosts = [
    {% for post in site.posts limit:20 %}
      {% unless post.url == page.url %}
      {
        title: {{ post.title | jsonify }},
        url: {{ post.url | jsonify }},
        excerpt: {{ post.excerpt | strip_html | truncate: 80 | jsonify }},
        tags: {{ post.tags | jsonify }}
      }{% unless forloop.last %},{% endunless %}
      {% endunless %}
    {% endfor %}
  ];
  
  console.log('üìö Posts disponibles:', allPosts.length);
  console.log('üè∑Ô∏è Tags del post actual:', currentTags);
  
  // Encontrar post relacionado por tags
  var relatedPost = null;
  if (currentTags && currentTags.length > 0) {
    for (var i = 0; i < allPosts.length; i++) {
      var post = allPosts[i];
      if (!post.tags) continue;
      
      for (var j = 0; j < post.tags.length; j++) {
        if (currentTags.indexOf(post.tags[j]) !== -1) {
          relatedPost = post;
          console.log('‚úÖ Post relacionado encontrado:', relatedPost.title);
          break;
        }
      }
      if (relatedPost) break;
    }
  }
  
  if (!relatedPost) {
    console.log('‚ùå No se encontr√≥ post relacionado');
    return;
  }
  
  // Crear el HTML del enlace relacionado
  var container = document.createElement('div');
  container.className = 'inline-related-post';
  container.style.cssText = 'margin: 2.5rem 0; animation: fadeInUp 0.5s ease-out;';
  
  var box = document.createElement('div');
  box.className = 'inline-cta';
  box.style.cssText = 'display: flex; gap: 1rem; padding: 1.5rem; background: var(--color-bg-secondary);; border: 1px solid #d4cfc5; border-left: 4px solid #f34f29; border-radius: 8px; box-shadow: 0 2px 8px rgba(60, 48, 38, 0.08); transition: all 0.3s ease; cursor: pointer;';
  
  var icon = document.createElement('div');
  icon.style.cssText = 'font-size: 2rem; line-height: 1; flex-shrink: 0; margin-top: 0.25rem;';
  icon.textContent = 'üí°';
  
  var content = document.createElement('div');
  content.style.cssText = 'flex: 1;';
  
  var label = document.createElement('p');
  label.style.cssText = 'font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #6e6658; margin: 0 0 0.5rem; font-weight: 600;';
  label.textContent = 'ART√çCULO RELACIONADO';
  
  var link = document.createElement('a');
  link.href = relatedPost.url;
  link.style.cssText = 'font-family: Georgia, serif; font-size: 1.1rem; font-weight: 600; color: #3c3026; text-decoration: none; display: block; margin-bottom: 0.5rem; transition: color 0.2s;';
  link.innerHTML = relatedPost.title + ' ‚Üí';
  
  var excerpt = document.createElement('p');
  excerpt.style.cssText = 'font-family: Georgia, serif; font-size: 0.9rem; color: #6e6658; margin: 0; line-height: 1.5;';
  excerpt.textContent = relatedPost.excerpt;
  
  content.appendChild(label);
  content.appendChild(link);
  content.appendChild(excerpt);
  
  box.appendChild(icon);
  box.appendChild(content);
  container.appendChild(box);
  
  // Hover effects
  box.addEventListener('mouseenter', function() {
    this.style.transform = 'translateY(-2px)';
    this.style.boxShadow = '0 4px 16px rgba(243, 79, 41, 0.15)';
    link.style.color = '#f34f29';
  });
  
  box.addEventListener('mouseleave', function() {
    this.style.transform = 'translateY(0)';
    this.style.boxShadow = '0 2px 8px rgba(60, 48, 38, 0.08)';
    link.style.color = '#3c3026';
  });
  
  // INSERTAR INLINE despu√©s del p√°rrafo 2
  function insertInline() {
    var postContent = document.querySelector('.post-content');
    if (!postContent) {
      console.log('‚ùå No se encontr√≥ .post-content');
      return;
    }
    
    console.log('‚úÖ .post-content encontrado');
    
    // Buscar todos los p√°rrafos con contenido sustancial
    var allP = postContent.querySelectorAll('p');
    var paragraphs = [];
    
    for (var i = 0; i < allP.length; i++) {
      var p = allP[i];
      // Filtrar p√°rrafos vac√≠os o muy cortos
      if (p.textContent.trim().length > 50 && !p.querySelector('img')) {
        paragraphs.push(p);
      }
    }
    
    console.log('üìù P√°rrafos encontrados:', paragraphs.length);
    
    // Solo insertar si hay al menos 4 p√°rrafos
    if (paragraphs.length >= 4) {
      var targetParagraph = paragraphs[1]; // Despu√©s del p√°rrafo 2 (√≠ndice 1)
      
      // Insertar JUSTO DESPU√âS del p√°rrafo
      targetParagraph.parentNode.insertBefore(container, targetParagraph.nextSibling);
      
      console.log('‚úÖ Enlace relacionado insertado despu√©s del p√°rrafo 2');
    } else {
      console.log('‚ö†Ô∏è Post muy corto (menos de 4 p√°rrafos), no se inserta enlace');
    }
  }
  
  // Ejecutar cuando el DOM est√© listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', insertInline);
  } else {
    insertInline();
  }
})();
</script>
